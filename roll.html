<!-- roll.html (progress bar, auto-scroll inside slides, no top overlay) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>WG – Roll</title>

  
  <style>
    :root{--bg:#0f1115;--card:#171a21;--muted:#a9b0bd;--text:#e9ecf2;--accent:#6ea8fe;--line:#252a35;}
    html,body{margin:0;padding:0;width:100%;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
    *{box-sizing:border-box;}

    .stage{position:fixed;inset:0;padding:14px;}
    .card{position:relative;width:100%;height:100%;background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden;}

    .viewport{position:absolute;inset:0;overflow:hidden;}
    .slide{position:absolute;inset:0;opacity:0;transition:opacity .35s ease;}
    .slide.active{opacity:1;}

    .scrollbox{
      position:absolute;inset:0;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      scrollbar-width:thin;
      scrollbar-color: rgba(255,255,255,.18) transparent;
    }
    .scrollbox::-webkit-scrollbar{width:8px;height:8px;}
    .scrollbox::-webkit-scrollbar-thumb{background:rgba(255,255,255,.14);border-radius:99px;}
    .scrollbox::-webkit-scrollbar-track{background:transparent;}

    iframe{width:100%;height:100%;border:0;display:block;background:#0b0d12;}

    .center{min-height:100%;display:grid;place-items:center;padding:40px 18px;}
    .clock{font-size:92px;font-weight:950;line-height:1;}
    .date{margin-top:10px;color:var(--muted);font-size:18px;text-align:center;}
    .weather{margin-top:18px;display:grid;gap:10px;min-width:min(820px, 100%);}
    .wrow{display:flex;gap:10px;flex-wrap:wrap;}
    .wbox{flex:1;min-width:240px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.02);border-radius:16px;padding:14px;}
    .wlabel{color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.03em;}
    .wval{margin-top:6px;font-size:22px;font-weight:900;}

    .barWrap{
      position:absolute;left:0;right:0;bottom:0;
      height:10px;
      background:rgba(255,255,255,.06);
      border-top:1px solid rgba(255,255,255,.06);
    }
    .bar{
      height:100%;
      width:0%;
      background:rgba(110,168,254,.75);
      transition:width .05s linear;
    }
  </style>
</head>
<body>
  <div class="stage">
    <div class="card">
      <div class="viewport">

        <div class="slide active" id="s0">
          <div class="scrollbox" data-autoscroll="true">
            <iframe
              src="https://abfahrtsanzeige.zvv.ch/monitor/#eyJzdGF0aW9ucyI6W3sic3RhdGlvbklEIjoiODU5MTEyMiIsIndhbGtpbmdEaXN0YW5jZSI6NH1dLCJsYW5ndWFnZSI6ImVuIiwiY2xvY2siOiJhbmFsb2ciLCJzaG93Rm9vdHBhdGgiOnRydWUsImhlYWRlclNjYWxpbmciOjEsInJvd1NjYWxpbmciOjEuMiwib3JkZXJJZCI6IjhlZmZlODU2LTQifQ=="
              referrerpolicy="no-referrer"
              loading="lazy"
              allow="fullscreen; geolocation"
            ></iframe>
          </div>
        </div>

        <div class="slide" id="s1">
          <div class="scrollbox" data-autoscroll="true">
            <iframe src="./chores.html" loading="lazy"></iframe>
          </div>
        </div>

        <div class="slide" id="s2">
          <div class="scrollbox" data-autoscroll="true">
            <div class="center">
              <div style="text-align:center;width:100%;">
                <div class="clock" id="clock">--:--</div>
                <div class="date" id="date">—</div>
                <div class="weather">
                  <div class="wrow">
                    <div class="wbox">
                      <div class="wlabel">Location</div>
                      <div class="wval">Zurich</div>
                    </div>
                    <div class="wbox">
                      <div class="wlabel">Condition</div>
                      <div class="wval" id="wCond">—</div>
                    </div>
                  </div>
                  <div class="wrow">
                    <div class="wbox">
                      <div class="wlabel">Temperature</div>
                      <div class="wval" id="wTemp">—</div>
                    </div>
                    <div class="wbox">
                      <div class="wlabel">Wind</div>
                      <div class="wval" id="wWind">—</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="barWrap"><div class="bar" id="bar"></div></div>
    </div>
  </div>

  <script>
    const slides = ["s0","s1","s2"];
    const DURATION_MS = 25000;

    const bar = document.getElementById("bar");

    const weatherCode = (c) => {
      const m = {
        0:"Clear",
        1:"Mainly clear", 2:"Partly cloudy", 3:"Overcast",
        45:"Fog", 48:"Depositing rime fog",
        51:"Light drizzle", 53:"Drizzle", 55:"Dense drizzle",
        56:"Freezing drizzle", 57:"Dense freezing drizzle",
        61:"Slight rain", 63:"Rain", 65:"Heavy rain",
        66:"Freezing rain", 67:"Heavy freezing rain",
        71:"Slight snow", 73:"Snow", 75:"Heavy snow",
        77:"Snow grains",
        80:"Rain showers", 81:"Heavy rain showers", 82:"Violent rain showers",
        85:"Snow showers", 86:"Heavy snow showers",
        95:"Thunderstorm", 96:"Thunderstorm + hail", 99:"Thunderstorm + heavy hail"
      };
      return m[c] ?? ("Code " + c);
    };

    function tickClock(){
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      document.getElementById("clock").textContent = `${hh}:${mm}`;
      document.getElementById("date").textContent = d.toLocaleDateString("de-CH",{weekday:"long",year:"numeric",month:"long",day:"numeric"});
    }

    async function loadWeatherZurich(){
      try{
        const lat = 47.3769, lon = 8.5417;
        const url = "https://api.open-meteo.com/v1/forecast?latitude="+lat+"&longitude="+lon+"&current=temperature_2m,weather_code,wind_speed_10m&timezone=Europe%2FZurich";
        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) return;
        const j = await res.json();
        const cur = j?.current;
        if(!cur) return;
        document.getElementById("wTemp").textContent = (Number(cur.temperature_2m).toFixed(1) + " °C");
        document.getElementById("wWind").textContent = (Number(cur.wind_speed_10m).toFixed(0) + " km/h");
        document.getElementById("wCond").textContent = weatherCode(cur.weather_code);
      }catch(e){}
    }

    function setActive(idx){
      slides.forEach((id,i)=>document.getElementById(id).classList.toggle("active", i===idx));
      const el = document.getElementById(slides[idx]).querySelector(".scrollbox");
      if(el) el.scrollTop = 0;
    }

    function startAutoScrollForActive(){
      const active = document.querySelector(".slide.active .scrollbox");
      if(!active) return () => {};

      let raf = 0;
      let last = 0;
      let dir = 1;

      const step = (t) => {
        if(!last) last = t;
        const dt = (t - last);
        last = t;

        const max = active.scrollHeight - active.clientHeight;
        if(max <= 2){
          raf = requestAnimationFrame(step);
          return;
        }

        const pxPerSec = 18;
        active.scrollTop += dir * (pxPerSec * dt / 1000);

        if(active.scrollTop >= max - 1) dir = -1;
        if(active.scrollTop <= 0) dir = 1;

        raf = requestAnimationFrame(step);
      };

      raf = requestAnimationFrame(step);
      return () => cancelAnimationFrame(raf);
    }

    let idx = 0;
    let slideStart = performance.now();
    let stopScroll = () => {};

    function nextSlide(){
      stopScroll();
      idx = (idx + 1) % slides.length;
      setActive(idx);
      slideStart = performance.now();
      stopScroll = startAutoScrollForActive();
    }

    function loopBar(t){
      const p = Math.min(1, (t - slideStart) / DURATION_MS);
      bar.style.width = (p * 100).toFixed(3) + "%";
      if(p >= 1) nextSlide();
      requestAnimationFrame(loopBar);
    }

    function start(){
      tickClock();
      setInterval(tickClock, 10000);

      loadWeatherZurich();
      setInterval(loadWeatherZurich, 10*60*1000);

      setActive(0);
      stopScroll = startAutoScrollForActive();
      requestAnimationFrame(loopBar);
    }

    start();
  </script>
</body>
</html>
